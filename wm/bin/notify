#!/bin/sh
#
# send a notification using lemonbar
# depends on https://github.com/marinhoc/bin/tree/master/fts
#
# wm tool

# SETTINGS

padding=20
offset_x=30
offset_y=60
time=5

# SCRIPT

# kill previous notification
pkill -f "lemonbar .* -d"

while [ $# -gt 0 ]; do
    case $1 in
        -t) time="$2";;
        -m) text="$2";;
    esac
    shift
    shift
done

# get notification dimensions
var=$(fts -w ~/.fonts/cherry-r.pcf)
width=$(( ${#text} * var + 2 * padding ))

var=$(fts -h ~/.fonts/cherry-r.pcf)
height=$(( var + 2 * padding ))

# get notification offset
var=$(bspc query -T -m | jq .rectangle.width)
offset_x=$(( var - offset_x - width ))

( echo "%{c}$text"; sleep "$time" ) | \
    lemonbar -g "${width}x${height}+${offset_x}+${offset_y}" \
    -f "-t-cherry-medium-r-normal--10-100-75-75-c-100-iso8859-1" \
    -B \#EEEEEE \
    -F \#021B21 \
    -d &
