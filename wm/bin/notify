#!/bin/sh
#
# send a notification with lemonbar
# depends on `fts` and `ftf` (bin repo)
#
# wm script

# kill previous notification
pkill -f "lemonbar .* -d"

# configuration

# default timeout
t=5

# geometry
p=20
x=30
y=60

# appearance
fg=\#021B21
bg=\#EEEEEE
ft=-t-cherry-medium-r-normal--10-100-75-75-c-100-iso8859-1

# parse options
while [ $# -gt 0 ]; do
    case $1 in
        -t) t="$2";;
        -m) m="$2"
    esac
    
    shift; shift
done

# get notification size
pt=$(ftf "$ft")
var=$(bspc query -T -m | jq .rectangle.width)

h=$(fts -h "$pt")
w=$(fts -w "$pt")

h=$(( h + 2 * p ))
w=$(( ${#m} * w + 2 * p ))
x=$(( var - x - w ))

{
    echo "%{c}$m"
    sleep "$t"
} | \
    lemonbar -g "${w}x${h}+${x}+${y}" \
    -F "$fg" \
    -B "$bg" \
    -f "$ft" \
    -d &
