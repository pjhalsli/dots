#!/bin/sh
#
# send a notification using lemonbar
# depends on `fts` and `ftf` (bin repo)
#
# wm script

# source config file
config=~/.config/notify/config
[ -f "$config" ] && . "$config" || exit 1

# kill previous notification
pkill -f "lemonbar .* -d"

while [ $# -gt 0 ]; do
    case $1 in
        -t) time="$2";;
        -m) text="$2"
    esac
    shift
    shift
done

# get font infos
path=$(ftf "$font")
height=$(fts -h "$path")
width=$(fts -w "$path")

# get notification size
height=$(( height + 2 * padding ))
width=$(( ${#text} * width + 2 * padding ))

# get notification offset
var=$(bspc query -T -m | jq .rectangle.width)
offset_x=$(( var - offset_x - width ))

( echo "%{c}$text"; sleep "$time" ) | \
    lemonbar -g "${width}x${height}+${offset_x}+${offset_y}" \
    -F "$foreground" \
    -B "$background" \
    -f "$font" \
    -d &
