#!/bin/sh
#
# send a notification using lemonbar
# depends on `fts` and `ftf` (bin repo)
#
# wm script

# config
time=5

padding=20
offset_x=30
offset_y=60

foreground=\#021B21
background=\#EEEEEE
font=-t-cherry-medium-r-normal--10-100-75-75-c-100-iso8859-1

# kill previous notification
pkill -f "lemonbar .* -d"

while [ $# -gt 0 ]; do
    case $1 in
        -t) time="$2";;
        -m) text="$2"
    esac
    shift; shift
done

# get font values
path=$(ftf "$font")
height=$(fts -h "$path")
width=$(fts -w "$path")

# get notification size
height=$((height + 2 * padding))
width=$((${#text} * width + 2 * padding))

# get notification offset
var=$(bspc query -T -m | jq .rectangle.width)
offset_x=$((var - offset_x - width))

{
    echo "%{c}$text"
    sleep "$time"
} | \
    lemonbar -g "${width}x${height}+${offset_x}+${offset_y}" \
    -F "$foreground" \
    -B "$background" \
    -f "$font" \
    -d &
