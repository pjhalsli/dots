#!/bin/sh
#
# draw terminals

# make the newly spawned window floating
bspc rule -a \* -o state=floating

slop -f '%x %y %w %h' |
{
    read -r x y w h

    # take borders into account
    b=$(bspc config border_width)

    w=$((w - 2 * b))
    h=$((h - 2 * b))

    urxvtc &

    # wait for our window to spawn
    # then move it and resize it
    bspc subscribe node_add |
    {
        read -r _

        # shortcut
        var=.client.floatingRectangle

        bspc query -T -n | jq -r "
            [
                $var.x,
                $var.y,
                $var.width,
                $var.height
            ] | @sh" |
        {
            read -r cur_x cur_y cur_w cur_h

            x=$((x - cur_x))
            y=$((y - cur_y))
            w=$((w - cur_w))
            h=$((h - cur_h))

            # move and resize
            bspc node -v "$x" "$y" -z bottom_right "$w" "$h"
        }
    }
}
