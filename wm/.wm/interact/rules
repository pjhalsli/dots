#!/bin/sh
#
# external rules

percent=66

# if there are preselections on the current workspace
# get the newest one and spawn the new window there first
presel=$(bspc query -N -n newest.local.!automatic) &&
{ echo "node = $node"; exit; }

# we don't want to measure non floating windows
# get the newest tiled window instead, exit if there is none
node=$(bspc query -N -n newest.local.tiled) || exit

wattr wh "$node" |
{
    read -r w h

    ratio=$((h * 100 / w))

    # split horizontally if ratio < percent
    # split vertically otherwise
    [ "$ratio" -lt "$percent" ] && split=east || split=south

    echo "split_dir = $split"
}

echo "node = $node"
